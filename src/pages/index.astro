---
import { getCollection, type CollectionEntry } from 'astro:content';
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import Hero from '@sections/marketing/Hero.astro';
import LogoCloud from '@sections/marketing/LogoCloud.astro';
import HowItWorks from '@sections/marketing/HowItWorks.astro';
import FeaturesSection from '@sections/marketing/FeaturesSection.astro';
import BentoGrid from '@sections/marketing/BentoGrid.astro';
import PricingTable from '@sections/pricing/PricingTable.astro';
import TestimonialsSection from '@sections/social-proof/TestimonialsSection.astro';
import CTA from '@sections/marketing/CTA.astro';
import Newsletter from '@sections/marketing/Newsletter.astro';
import { siteConfig } from '@/config';
import IntegrationsGrid from '@sections/marketing/IntegrationsGrid.astro';

type TestimonialEntry = CollectionEntry<'testimonials'>;

const testimonials = await getCollection(
  'testimonials',
  ({ data }: { data: TestimonialEntry['data'] }) => !data.draft
);
const sortedTestimonials = [...testimonials].sort(
  (a: TestimonialEntry, b: TestimonialEntry) => a.data.order - b.data.order
);

const integrations = [
  {
    name: 'GitLab',
    logo: '/images/integrations/gitlab.svg',
    category: 'Development',
    featured: true,
    description: 'Full CI/CD integration with GitLab repositories.',
    href: '/integrations',
  },
  {
    name: 'Slack',
    logo: '/images/integrations/slack.svg',
    category: 'Communication',
    featured: true,
    description: 'Get deployment notifications and alerts in your Slack channels.',
    href: '/integrations',
  },
  {
    name: 'n8n',
    logo: '/images/integrations/n8n.svg',
    category: 'Automation',
    featured: true,
    description: 'Workflow automation with n8n integrations.',
    href: '/integrations',
  },
];

const featuredIntegrations = integrations.filter((i) => i.featured);

const bentoItems = [
  {
    title: 'Local Knowledge Packs',
    description:
      'All humanity’s knowledge – downloaded once, stored locally, and never leaves your device.',
    icon: 'lucide:book',
    size: 'large' as const,
    accent: 'primary' as const,
    href: '/docs/knowledge-packs',
  },
  {
    title: 'Secure Vault',
    description: 'Encrypted conversations stored locally on your hardware.',
    icon: 'lucide:lock',
    accent: 'blue' as const,
    href: '/docs/encryption',
  },
  {
    title: 'Auto‑Update',
    description: 'Periodically sync new knowledge blocks over a local channel – no internet required.',
    icon: 'lucide:refresh-cw',
    accent: 'green' as const,
    href: '/docs/updates',
  },
  {
    title: 'Cross‑Device Freedom',
    description:
      'Move your Flowster instance from a phone to a laptop, a tablet to a grandchild – no compromise.',
    icon: 'lucide:laptop',
    size: 'medium' as const,
    accent: 'purple' as const,
    href: '/docs/migration',
  },
];

const features = [
  {
    icon: 'lucide:shield',
    title: 'Tamper‑Proof',
    description:
      'No network connection, no remote back‑door. The software remains unchanged unless you decide to upgrade.',
  },
  {
    icon: 'lucide:zap',
    title: 'Instant Access',
    description:
      'All knowledge loaded locally. Start asking questions immediately – no latency, no data‑transfer cost.',
  },
  {
    icon: 'lucide:globe',
    title: 'Global Reach, Local Control',
    description:
      'Serve your own data, not a cloud. No third‑party analytics or tracking.',
  },
  {
    icon: 'lucide:github',
    title: 'Open Source',
    description:
      'Audit the entire stack. Contribute or run it on a Raspberry Pi – the choice is yours.',
  },
  {
    icon: 'lucide:handshake',
    title: 'Community‑Driven',
    description:
      'Support from a network of users who value privacy. No sales funnels, no upsells.',
  },
];

const pricingPlans = [
  {
    name: 'Sovereign License',
    monthlyPrice: null,
    description: 'One‑time purchase. Own Flowster forever. No subscription, no renewal.',
    features: ['All knowledge offline', 'Local encryption', 'Auto‑updates via local channel', 'Open‑source source code'],
    cta: { label: 'Buy Now', href: '/purchase' },
  },
];
---

<MarketingLayout
  title={`${siteConfig.name} - ${siteConfig.description}`}
  description={siteConfig.description}
>
  <Hero
    title="Your Sovereign AI – 100 % Offline, 100 % Yours"
    subtitle="Own every question, answer, and conversation on your own hardware. No internet, no cloud, no third‑party data collectors."
    primaryCTA={{ label: 'Purchase Flowster', href: '/purchase' }}
    secondaryCTA={{ label: 'Learn More', href: '/docs' }}
  />

  <LogoCloud
    title="Trusted by privacy‑conscious individuals worldwide"
    logos={[
      { name: 'Logo Ipsum 1', src: '/images/logos/logoipsum-1.svg' },
      { name: 'Logo Ipsum 2', src: '/images/logos/logoipsum-2.svg' },
      { name: 'Logo Ipsum 3', src: '/images/logos/logoipsum-3.svg' },
      { name: 'Logo Ipsum 4', src: '/images/logos/logoipsum-4.svg' },
      { name: 'Logo Ipsum 5', src: '/images/logos/logoipsum-5.svg' },
      { name: 'Logo Ipsum 6', src: '/images/logos/logoipsum-6.svg' },
    ]}
    grayscale={false}
    logoSize="lg"
  />

  <HowItWorks
    title="Run Flowster in 3 simple steps"
    subtitle="Set up locally, download the knowledge library, start asking."
    steps={[
      {
        title: 'Purchase & Install',
        description:
          "Download the Flowster installer, run it on your machine, and choose a local storage folder.",
        icon: 'lucide:download',
      },
      {
        title: 'Download Knowledge Pack',
        description:
          'Grab the latest humanity knowledge pack from a USB or local network share – no internet needed.',
        icon: 'lucide:archive',
      },
      {
        title: 'Start Converting',
        description:
          'Ask questions, generate text, or explore offline. All data stays on your device.',
        icon: 'lucide:message-square',
      },
    ]}
    variant="horizontal"
    background="muted"
  />

  <IntegrationsGrid
    title="Seamless Offline Integration"
    subtitle="Plug Flowster into your existing workflows without exposing data to the cloud."
    integrations={featuredIntegrations}
    variant="detailed"
    invertOnDark={false}
    columns={3}
    background="default"
    footerLink={{ label: 'View all integrations →', href: '/integrations' }}
  />

  <FeaturesSection
    title="Features that keep your data private"
    subtitle="Everything you need, locally. No data ever leaves your hardware."
    features={features}
    background="muted"
    footerLink={{ label: 'Read the docs →', href: '/docs' }}
  />

  <BentoGrid
    title="Developer‑First Offline AI"
    subtitle="Built by the open‑source community, for anyone who values freedom."
    items={bentoItems}
    background="muted"
  />

  <PricingTable
    title="Simple, transparent pricing"
    subtitle="Own Flowster forever – one‑time payment, no recurring costs."
    plans={pricingPlans}
    annualDiscount={null}
    background="default"
    footerLink={{ label: 'Learn about license →', href: '/license' }}
  />

  {
    siteConfig.features.testimonials && sortedTestimonials.length > 0 && (
      <TestimonialsSection
        title="Praised by privacy advocates"
        subtitle="People everywhere are choosing Flowster for the freedom it offers."
        background="muted"
        limit={4}
        footerLink={{ label: 'See all testimonials →', href: '/testimonials' }}
        testimonials={sortedTestimonials.map((t) => ({
          quote: t.data.quote,
          author: t.data.author,
          role: t.data.role,
          company: t.data.company,
          avatar: t.data.avatar,
        }))}
      />
    )
  }

  <CTA
    title="Ready to own your knowledge?"
    description="Purchase Flowster today and bring the entire humanities knowledge base into your own hands."
    action={{ label: 'Buy Now', href: '/purchase' }}
  />

  <Newsletter />
</MarketingLayout>